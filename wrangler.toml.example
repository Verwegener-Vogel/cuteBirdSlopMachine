name = "cute-bird-slop-machine"
main = "src/index.ts"
compatibility_date = "2025-07-20"

[vars]
ENVIRONMENT = "development"

[env.production]
vars = { ENVIRONMENT = "production" }

[env.preview]
vars = { ENVIRONMENT = "preview" }

[[kv_namespaces]]
binding = "PROMPTS_KV"
id = "YOUR_KV_NAMESPACE_ID"
preview_id = "YOUR_KV_PREVIEW_ID"

[[d1_databases]]
binding = "DB"
database_name = "bird-prompts-db"
database_id = "YOUR_D1_DATABASE_ID"

[[queues.producers]]
binding = "VIDEO_QUEUE"
queue = "video-generation-queue"

[[queues.consumers]]
queue = "video-generation-queue"
max_batch_size = 10
max_retries = 3
dead_letter_queue = "video-generation-dlq"

[[r2_buckets]]
binding = "VIDEO_STORAGE"
bucket_name = "cute-bird-videos"
preview_bucket_name = "cute-bird-videos-preview"

[triggers]
# Poll for video completion every minute
crons = ["*/1 * * * *", "0 */6 * * *"]
# First cron: Poll videos every minute
# Second cron: Generate new prompts every 6 hours